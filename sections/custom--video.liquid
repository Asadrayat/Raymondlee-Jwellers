{% comment %} File: sections/custom-video.liquid {% endcomment %}
<style>
  .section-container--{{ section.id }} {
    margin-top: {{ section.settings.margin_top | append: 'px' }};
    margin-bottom: {{ section.settings.margin_bottom | append: 'px' }};
    padding-top: {{ section.settings.padding_top | append: 'px' }};
    padding-bottom: {{ section.settings.padding_bottom | append: 'px' }};
    overflow: hidden;
    background-color: {{ section.settings.bg_color | default: 'transparent' }};
  }

  .section-container--{{ section.id }} .content-wrapper {
    display: block;
  }

  .section-container--{{ section.id }} .video-wrapper {
    position: relative;
    width: 100%;
    aspect-ratio: 1300/600;
    @media(max-width: 768px){
     aspect-ratio: 4/5;   
    }
  }

  .section-container--{{ section.id }} .video-wrapper > video {
    width: 100%;
    height: 100%;
    object-fit: cover;
    {% comment %} border-radius: 15px; {% endcomment %}
    display: block;
    z-index: 0;
    cursor: pointer;
  }

  .section-container--{{ section.id }} .thumbnail {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    object-fit: cover;
    z-index: 1;
    transition: opacity 0.3s ease;
    pointer-events: none; /* Prevent thumbnail from intercepting clicks */
  }

  .section-container--{{ section.id }} #play-{{ section.id }} {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    display: flex;
    justify-content: center;
    align-items: center;
    cursor: pointer;
    z-index: 2;
    transition: opacity 0.3s ease;
  }

  .section-container--{{ section.id }} #play-{{ section.id }} .play--icon {
    width: 10vw;
    height: 10vw;
    max-width: 80px;
    max-height: 80px;
    fill: {{ section.settings.play_button_color | default: '#ffffff' }};
    {% comment %} background: #0000003d;
    border-radius: 50%; {% endcomment %}
  }
  .section-container--{{ section.id }} #play-{{ section.id }} .play--icon--img {
    width: 100%;
    height: auto;
    max-width: 80px;
    max-height: 80px;
  }

  @media screen and (max-width: 768px) {
    .section-container--{{ section.id }} {
      margin-top: {{ section.settings.margin_top_mobile | append: 'px' }};
      margin-bottom: {{ section.settings.margin_bottom_mobile | append: 'px' }};
      padding-top: {{ section.settings.padding_top_mobile | append: 'px' }};
      padding-bottom: {{ section.settings.padding_bottom_mobile | append: 'px' }};
    }

    .section-container--{{ section.id }} #play-{{ section.id }} .play--icon {
      width: 15vw;
      height: 15vw;
      max-width: 60px;
      max-height: 60px;
    }
  }
</style>

<section class="section-container--{{ section.id }}">  
  <div class="section-wrapper--{{ section.id }} page-width">
    <h2 class="--section-title">{{ section.settings.title }}</h2>
    <div class="content-wrapper">
      <div class="video-wrapper">
        {% unless section.settings.video == blank %}
          {{
            section.settings.video
            | video_tag:
              autoplay: false,
              loop: true,
              muted: true,
              controls: false,
              image_size: '600x',
              class: '--custom-video-text',
              loading: 'lazy'
          }}
        {% endunless %}

        {% unless section.settings.img == blank %}
          {{ section.settings.img | image_url: width: section.settings.img.width | image_tag: class: 'thumbnail', loading: 'lazy', alt: 'Video thumbnail' }}
        {% endunless %}

        <div id="play-{{ section.id }}" role="button" aria-label="Play or pause video" tabindex="0">
          {% comment %} <svg
            width="80"
            height="80"
            viewBox="0 0 36 36"
            version="1.1"
            preserveAspectRatio="xMidYMid meet"
            xmlns="http://www.w3.org/2000/svg"
            xmlns:xlink="http://www.w3.org/1999/xlink"
          >
            <path class="clr-i-solid clr-i-solid-path-1" d="M32.16,16.08,8.94,4.47A2.07,2.07,0,0,0,6,6.32V29.53a2.06,2.06,0,0,0,3,1.85L32.16,19.77a2.07,2.07,0,0,0,0-3.7Z"></path>
            <rect x="0" y="0" width="36" height="36" fill-opacity="0"/>
          </svg> {% endcomment %}
        {% if section.settings.play_icon != blank %}
          {{ section.settings.play_icon | image_url: width: section.settings.img.width | image_tag: class: 'play--icon play--icon--img', loading: 'lazy', alt: 'Video play_icon' }}
        {% else %}
<svg class="play--icon" xmlns="http://www.w3.org/2000/svg" width="84" height="84" viewBox="0 0 84 84" fill="none">
<foreignObject x="-8" y="-8" width="100" height="100"><div xmlns="http://www.w3.org/1999/xhtml" style="backdrop-filter:blur(4px);clip-path:url(#bgblur_0_775_19700_clip_path);height:100%;width:100%"></div></foreignObject><circle data-figma-bg-blur-radius="8" cx="42" cy="42" r="42" fill="white" fill-opacity="0.1"/>
<circle cx="42" cy="42" r="28" fill="white"/>
<path fill-rule="evenodd" clip-rule="evenodd" d="M33 33.7198C33 31.8944 35.0016 30.7759 36.5562 31.7326L50.0121 40.0132C51.4928 40.9244 51.4928 43.0765 50.0121 43.9876L36.5562 52.2681C35.0016 53.2249 33 52.1064 33 50.2809V33.7198Z" fill="#AA7248"/>
<defs>
<clipPath id="bgblur_0_775_19700_clip_path" transform="translate(8 8)"><circle cx="42" cy="42" r="42"/>
</clipPath></defs>
</svg>
        {% endif %}

        </div>
      </div>
    </div>
  </div>
</section>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const playButton = document.getElementById('play-{{ section.id }}');
    const video = document.querySelector('.section-container--{{ section.id }} .--custom-video-text');
    const thumbnail = document.querySelector('.section-container--{{ section.id }} .thumbnail');

    if (playButton && video) {
      const togglePlay = (event) => {
        event.stopPropagation();
        if (video.paused) {
          console.log('Playing video');
          video.play().catch(err => console.error('Video play failed:', err));
          playButton.style.opacity = '0';
          playButton.style.pointerEvents = 'none';
          if (thumbnail) thumbnail.style.opacity = '0';
          video.style.zIndex = '2';
        } else {
          console.log('Pausing video');
          video.pause();
          video.currentTime = 0;
          playButton.style.opacity = '1';
          playButton.style.pointerEvents = 'auto';
          if (thumbnail) thumbnail.style.opacity = '1';
          video.style.zIndex = '0';
        }
      };

      playButton.addEventListener('click', togglePlay);
      video.addEventListener('click', togglePlay);
      playButton.addEventListener('keydown', (event) => {
        if (event.key === 'Enter' || event.key === ' ') {
          event.preventDefault();
          togglePlay(event);
        }
      });
    } else {
      console.warn('Video or play button not found for section {{ section.id }}');
    }
  });
</script>

{% schema %}
{
  "name": "Custom Video",
  "settings": [
    {
      "type": "inline_richtext",
      "id": "title",
      "label": "Title"
    },
    {
      "type": "image_picker",
      "id": "img",
      "label": "Thumbnail Image"
    },
    {
      "type": "image_picker",
      "id": "play_icon",
      "label": "Play Icon"
    },
    {
      "type": "video",
      "id": "video",
      "label": "Video"
    },
    {
      "type": "color",
      "id": "bg_color",
      "label": "Background Color",
      "default": "transparent"
    },
    {
      "type": "color",
      "id": "play_button_color",
      "label": "Play Button Color",
      "default": "#ffffff"
    },
    {
      "type": "header",
      "content": "Desktop Spacing"
    },
    {
      "type": "range",
      "id": "margin_top",
      "min": 0,
      "max": 200,
      "step": 2,
      "unit": "px",
      "label": "Margin Top",
      "default": 0
    },
    {
      "type": "range",
      "id": "margin_bottom",
      "min": 0,
      "max": 200,
      "step": 2,
      "unit": "px",
      "label": "Margin Bottom",
      "default": 0
    },
    {
      "type": "range",
      "id": "padding_top",
      "min": 0,
      "max": 200,
      "step": 2,
      "unit": "px",
      "label": "Padding Top",
      "default": 50
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0,
      "max": 200,
      "step": 2,
      "unit": "px",
      "label": "Padding Bottom",
      "default": 50
    },
    {
      "type": "header",
      "content": "Mobile Spacing"
    },
    {
      "type": "range",
      "id": "margin_top_mobile",
      "min": 0,
      "max": 200,
      "step": 2,
      "unit": "px",
      "label": "Margin Top (Mobile)",
      "default": 0
    },
    {
      "type": "range",
      "id": "margin_bottom_mobile",
      "min": 0,
      "max": 200,
      "step": 2,
      "unit": "px",
      "label": "Margin Bottom (Mobile)",
      "default": 0
    },
    {
      "type": "range",
      "id": "padding_top_mobile",
      "min": 0,
      "max": 200,
      "step": 2,
      "unit": "px",
      "label": "Padding Top (Mobile)",
      "default": 20
    },
    {
      "type": "range",
      "id": "padding_bottom_mobile",
      "min": 0,
      "max": 200,
      "step": 2,
      "unit": "px",
      "label": "Padding Bottom (Mobile)",
      "default": 20
    }
  ],
  "presets": [
    {
      "name": "Custom Video"
    }
  ]
}
{% endschema %}